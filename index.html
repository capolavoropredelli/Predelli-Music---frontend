<!DOCTYPE html>

<html>

<head>
    <link rel="stylesheet" href="style/index.css">
    <style>
        #playlist-container {
            display: flex;
            flex-direction: column;
        }
    </style>
</head>

<body onload="load_info()">
    <div id="container">
        <div id="local-navbar">
            <a id="current">playlists</a>
            <a>tracks</a>
        </div>
        <p></p>
        <form method="get" id="search-container">
            <input type="text" placeholder="search" name="search" id="search-bar">
            <input type="submit" value="" id="search-button">
        </form>

        <div id="pl-container">
        </div>
    </div>

    <a href="musics.html?playlist=music"><button>all music</button></a>

    <script src="scripts/utils.js"></script>
    <script src="scripts/api.js"></script>
    <script>
        const p = document.querySelector("p");
        const playcontainer = document.getElementById("pl-container");
        const logout = document.getElementById("logout");
        const scan_button = document.getElementById("scan-again");
        const new_playlist_button = document.getElementById("new-playlist");


        const form_data = new FormData();



        async function load_info() {
            const result = await api_request("scan", "post", form_data);
            const playlist = await api_request("playlists", "post", form_data)

            playlist.forEach(p => {
                const pl_object = document.createElement("div");
                const pl_icon = document.createElement("div");
                const pl_name = document.createElement("p");
                pl_object.classList.add("pl-object");
                pl_icon.classList.add("pl-icon");
                pl_name.classList.add("pl-name");

                pl_name.innerText = p.name;
                pl_object.appendChild(pl_icon);
                pl_object.appendChild(pl_name);
                playcontainer.appendChild(pl_object);
            });

            const pl_object = document.createElement("div");
            const pl_icon = document.createElement("div");
            const pl_name = document.createElement("p");
            pl_object.classList.add("pl-object");
            pl_icon.id = "pl-add";
            pl_name.classList.add("pl-name");

            pl_name.innerText = "add playlist";
            pl_object.appendChild(pl_icon);
            pl_object.appendChild(pl_name);
            playcontainer.appendChild(pl_object);
        }

        scan_button.addEventListener("click", async function () {
            console.log("click");
            p.innerText = "updating tracks (first log in could take a while)";
            const result = await api_request("scan", "post", form_data);
            p.innerText = "tracks updated";
        })

        logout.addEventListener("click", async function () {
            const form_data = new FormData();
            const result = await api_request("logout", "POST", form_data);
            location.reload();
        })

    </script>
</body>


</html>
