<!DOCTYPE html>

<html>

<head></head>

<body>
    <h1>Login</h1>
    <form method="post" id="login-form" name="login-form">
        <input type="text" placeholder="username" name="username">
        <input type="password" placeholder="password" name="password">
        <input type="submit">
    </form>

    <script>
        const form = document.getElementById("login-form");

        form.addEventListener("submit", async function (event) {
            event.preventDefault();
            const form_data = new FormData(form);

            const response = await api_request("login", "POST", form_data);

            if(response.success == true) {
                sessionStorage.setItem("isLogged", true);
                
                console.log("redirecting...");
                window.location.replace("index.html");
            } else {
                console.log("token not saved");
            }
        });

        function get_template_form(meth, form_data) {
            return {
                method: meth,
                body: form_data
            }
        }

        async function api_request(route, method, form_data) {
            const API = "https://apimusic.predelli.site";
            const API_ROUTE = API + "/" + route;
            try {
                const response = await fetch(API_ROUTE, get_template_form(method, form_data));
                if (!response.ok) {
                    throw new Error("Response status :" + response.status);
                }

                const result = await response.json();

                return result;
            } catch (error) {
                console.error(error.message);
            }
        }

    </script>
</body>


</html>

